<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [WebSocket interface](#websocket-interface)
    -   [connectToSpdz](#connecttospdz)
    -   [isSpdzConnected](#isspdzconnected)
    -   [consumeData](#consumedata)
    -   [sendData](#senddata)
    -   [disconnectFromSpdz](#disconnectfromspdz)
-   [REST interface](#rest-interface)
    -   [restConnectToSpdz](#restconnecttospdz)
    -   [restGetSpdzConnection](#restgetspdzconnection)
    -   [restConsumeData](#restconsumedata)
    -   [restSendData](#restsenddata)
    -   [restDeleteSpdzConnection](#restdeletespdzconnection)
-   [Bootstrap interface](#bootstrap-interface)
    -   [startSpdz](#startspdz)

## WebSocket interface

The web socket API for a client to connect to the SPDZ Proxy. 
This is the recommended interface and is more complete.
Connect to the socket with  const socket = Io('<http://my-domain:8080>' + '/spdzapi', {path: '/spdz/socket.io'})


### connectToSpdz

Establish a stateful TCP connection to the running SPDZ process.
 See SPDZ instructions listen, acceptclientconnection.

**Parameters**

-   `clientPublicKey` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** Optional client public key as 64 char hex string.
     If supplied all data will be encrypted with RSA authenticated encryption. Client must have access to SPDZ engine 
     public key. See SPDZ instruction regint.read_client_public_key.

**Examples**

```javascript
Client code to connect to SPDZ:

socket.emit('connectToSpdz', 'e0c5f66f1306ef1aeeb744ef38abaa28bb6c836c2ab0124d93dd9586cae8dd17')
socket.on('connectToSpdz_result', response => {
  console.log(response.status)
})
```

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** event name connectToSpdz_result

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** JSON response with {status : 0 (succes) | 1 (error), err : error message }

### isSpdzConnected

Check to see if this web socket has a client connection to a SPDZ TCP socket.

**Examples**

```javascript
Client code to check connection:

socket.emit('isSpdzConnected')
socket.on('isSpdzConnected_result', response => {
  console.log(response.status)
})
```

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** event name isSpdzConnected_result

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** JSON response with {status : 0 (connected) | 1 (not connected) }

### consumeData

Data sent by SPDZ is pushed to the client as soon as it is received by the SPDZ Proxy.
 Push of data is set up in the connectToSpdz instruction. See SPDZ instructions sint, cint, regint, sfix, 
 cfix write_to_socket

**Examples**

```javascript
Client code to accept pushed SPDZ messages:

socket.on('spdz_message', response => {
  parseSpdzMessage(value)
})
```

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** event name spdz_message

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** data containing binary SPDZ data in little endian format. 
The SPDZ MPC instruction write_to_socket may write a 4 byte data type header. 
Data is optionally encrypted depending on connectToSpdz parameters.

### sendData

Send an array of inputs to the SPDZ engine over the previously established TCP socket.
 See SPDZ instructions sint, cint, regint read_from_socket.

**Parameters**

-   `dataType` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Either; modp - 128 bit Big Integer in Gfp field, Montgomery format, or int32 - 32 bit signed integer.
-   `dataArray` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** JSON structure containing array of base64 encoded 16 bytes (big endian) or integers.

**Examples**

```javascript
Client code to send modp big integers to SPDZ, for example shares of inputs:

socket.emit('sendData', 'modp', [
 'J72LqIgKBjKu5zFKt1vo4g==',
 'J72LqIgKBjKu5zFKt1vo4g=='
])
```

```javascript
Client code to send 32 bit integers to SPDZ:

socket.emit('sendData', 'int32', [1234, 7654])
```

```javascript
Client code to accept the result:

socket.on('sendData_result', response => {
  console.log(response.status)
})
```

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** event name sendData_result

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** JSON response with {status : 0 (succes) | 1 (error), err : error message }

### disconnectFromSpdz

Disconnect the client represented by this web socket from the SPDZ TCP connection.

**Examples**

```javascript
Client code to disconnect connection:

socket.emit('disconnectFromSpdz')
```

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** event name disconnectFromSpdz_result

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** JSON response with {status : 0 (success)}

## REST interface

Provides a simple REST interface to connect to a SPDZ engine, write input and read output.


### restConnectToSpdz

POST /spdzapi/connect-to-spdz. Establish a stateful TCP connection to the running SPDZ process using SPDZ instructions listen, acceptclientconnection.

**Parameters**

-   `clientId` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** Optional client id, if not supplied then generated and returned in Location header.
    Needs to be used in future interactions from this client.
-   `clientPublicKey` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)?** Optional client public key as 64 char hex string.
    If supplied all data will be encrypted with RSA authenticated encryption. 
    Client must have access to SPDZ engine public key. 
    See SPDZ instruction regint.read_client_public_key.

**Examples**

```javascript
Sending the request:
  POST /spdzapi/connect-to-spdz
  Host: my-domain:8080
  Content-Type: 'application/json; charset=utf-8'

  { "clientId": "123", "clientPublicKey" : "e0c5f66f1306ef1aeeb744ef38abaa28bb6c836c2ab0124d93dd9586cae8dd17"}
```

```javascript
Successful response with generated client id of 123:
  HTTP/1.1 201 Created
  Location: /123/spdz-connection
```

```javascript
Error response:
  HTTP/1.1 400 Bad Requst
  {
    status: 400,
    message: Socket for client 123 received error. ECONNREFUSED.
  }
```

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Location header for the connection resource containing generated client Id.

### restGetSpdzConnection

GET /:clientId/spdz-connection. Check client to SPDZ connection.

**Parameters**

-   `clientId` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Client id returned by previous /connect-to-spdz call.

**Examples**

```javascript
Sending the request:
  GET /123/spdz-connection
```

```javascript
Successful response:
  HTTP/1.1 200 Ok
```

```javascript
Error response:
  HTTP/1.1 404 Not Found
  {
    status: 404,
    message: No connection found for client id 123.
  }
```

### restConsumeData

POST /:clientId/consume-data?waitMs=1500. Consume and return SPDZ engine supplied data.
See SPDZ instructions sint.write_shares_to_socket, regint.write_to_socket.

**Parameters**

-   `clientId` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Client id returned by previous /connect-to-spdz call.
-   `waitMs` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** Optional query parameter, length of time in milliSecs to wait for data to become available. (optional, default `0`)

**Examples**

```javascript
Sending the request:
  POST /spdzapi/123/consume-data?waitMs=1000
```

```javascript
Successful response:
  HTTP/1.1 200 Ok
  Content-Type: application/octet-stream

  ...binary.....
```

```javascript
Error response:
  HTTP/1.1 204 No Content
  {
     status: 204,
     message: No buffer records are availabe to send to client 123.
  }
```

Returns **[Buffer](https://nodejs.org/api/buffer.html)** body data containing binary SPDZ data in little endian format.
Data is optionally encrypted depending on restConnectToSpdz parameters.

### restSendData

POST /:clientId/send-data. Send array of 128 bit big integers to SPDZ engine.
See SPDZ instruction cint, sint read_from_socket.

**Parameters**

-   `clientId` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Client id returned by previous /connect-to-spdz call.
-   `body` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** JSON structure containing array of base64 encoded 16 bytes (big endian).

**Examples**

```javascript
Sending the request:
  POST /spdzapi/123/send-data
  Host: my-domain:8080
  Content-Type: 'application/json; charset=utf-8'

  [
    'J72LqIgKBjKu5zFKt1vo4g==',
    'J72LqIgKBjKu5zFKt1vo4g=='
  ]
```

```javascript
Successful response:
  HTTP/1.1 200 Ok
```

```javascript
Error response:
  HTTP/1.1 400 Bad Request
  {
     status: 400,
     message: Unable to process data as expecting a JSON array of base64 encoded integers.
  }
```

### restDeleteSpdzConnection

DELETE /:clientId/spdz-connection. Close the socket connection to SPDZ.

**Parameters**

-   `clientId` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Client id returned by previous /connect-to-spdz call.

**Examples**

```javascript
Sending the request:
  DELETE /123/spdz-connection
```

```javascript
Successful response:
  HTTP/1.1 200 Ok
```

```javascript
Error response:
  HTTP/1.1 404 Not Found
  {
    status: 404,
    message: No connection found for client id 123.
  }
```

## Bootstrap interface

A websocket interface to allow a client to run SPDZ processes.
Connect to the socket with  const socket = Io('<http://my-domain:8080>' + '/spdzstart', {path: '/spdz/socket.io'})


### startSpdz

Run a predefined script to stop a running Spdz process and start a new one. The stop and start scripts are defined at deploy time and the recommended approach is to use Docker containers. The start script is sent 2 parameters: player Id, SPDZ MPC Program Name. The stop script is sent 2 parameters: player Id, force Stop flag (Y/N).

**Parameters**

-   `spdzProgram` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The precompiled spdz program name, passed to the start script, and used where a Docker container contains multiple possible SPDZ programs.
-   `forceStop` **[boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** If true then indicate to the stop script that a running Spdz process must be stopped.

**Examples**

```javascript
Client code to start a SPDZ process:

socket.emit('startSpdz', 'my_mpc_program', true)
socket.on('startSpdz_result', response => {
  console.log(response.status, response.err)
})
```

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** event name startSpdz_result

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** JSON response with {status : 0 (succes) | 1 (error), err : error message }
